{% extends 'base.html' %}

{% block head %}
    <title>Search Results for "{{input_string}}"</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
      $(document).ready(function(){
        $('.gamefilters').hide();
        $('.showgames').click(function(){
          if($(this).prop("checked")==true){
            $('.gamerow').show();
            $('.gamefilters').show();
          }
          else if($(this).prop("checked")==false){
            $('.gamerow').hide();
            $('.gamefilters').hide();
          }
          if($(".showgenres").prop("checked")==false){
            $('.genrerow').hide();
          }
          if($(".showpublishers").prop("checked")==false){
            $('.publisherrow').hide();
          }
        });
        $('.showgenres').click(function(){
          if($(this).prop("checked")==true){
            $('.genrerow').show();
          }
          else if($(this).prop("checked")==false){
            $('.genrerow').hide();
          }
          if($(".showgames").prop("checked")==false){
            $('.gamerow').hide();
          }
          if($(".showpublishers").prop("checked")==false){
            $('.publisherrow').hide();
          }
        });
        $('.showpublishers').click(function(){
          if($(this).prop("checked")==true){
            $('.publisherrow').show();
          }
          else if($(this).prop("checked")==false){
            $('.publisherrow').hide();
          }
          if($(".showgames").prop("checked")==false){
            $('.gamerow').hide();
          }
          if($(".showgenres").prop("checked")==false){
            $('.genrerow').hide();
          }
        });
        $('#min_minplayers').change(function(){
          $('#minplayerlimit').text($('#min_minplayers').val());
        });
        $('.minplayersfilter').click(function(){
          if($(this).prop("checked")==true){
            //hide all games that can be played with less than the minimum
            $('.gamerow').each(function(){
              if (parseInt($(this).find('.gminplayers').text()) < parseInt($('#minplayerlimit').text())) {
                $(this).hide();
              }
            });
          }
          else if($(this).prop("checked")==false){
            $('.gamerow').show();
          }
        });
      });
    </script>
  <style>
    .keywords{
      width: 10%;
    }
    td.name{
      width: 50%;
    }
    td.model{
      width: 10%;
    }
    td.image{
      width: 30%;
    }
  </style>
{% endblock %}
{% block bodywithmargin %}
<div class="container" style ="padding: 15% 0%">
  <div class="row">
    <div class="col-md-12">
      <div class="grid">
      <div class="grid-body">
        <div class="row">
          <div class="col-md-3">
            <h2>Filter Results</h2>
            <h4>Show only:</h4>
            <div class="modelfilter">
              <label><input type="checkbox" class="showgames">  board games</label>
            </div>
            <div class="modelfilter">
              <label><input type="checkbox" class="showgenres">  genres</label>
            </div>
            <div class="modelfilter">
              <label><input type="checkbox" class = "showpublishers">  publishers</label>
            </div>
            <div class="gamefilters">
            <h5>Filters for Board Games:</h5>
            <div class ="gamefilter">
              <label for="min_minplayers">Minimum Number of Players: <span id = "minplayerlimit">1</span></label>
              <input type="range" id="min_minplayers" min="1" max="10">
              <label><input type= "checkbox" class="minplayersfilter"> Apply filter</label>
            </div>
            </div>
          </div>
          <div class="col-md-9">
            <h2>Search Results for "{{input_string}}"</h2>
            <hr>
              <form class="input-group" action ="/search" method="POST">
                <input class="form-control mr-sm-2" type="text" placeholder="Search games, genres, publishers" name="search" style="width:300px">
                <button class="btn btn-outline-info my-2 my-sm-0" type="submit">Search</button>
              </form>
            <div class="padding"></div>
            <div class="row">
              <div class="col-sm-6">
                <div class="dropdown">
                  <button class="btn btn-secondary dropdown-toggle" type="button" id="sort_dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Sorting</button>
                  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <button class="btn btn-link" title="list" >normal</button>
                    <button class="btn btn-link" title="list" >alphabetical</button>
                  </div>
                </div>
              </div>
              <div class="table-responsive">
              <table class="table table-hover">
                <tbody>
                {% for g in exactmatches['boardgames'] %}
                <tr class = 'gamerow' style = "max-height:20%">
                  <td class="name text-center" style="width: 50%">
                    <form action="/game" method = "POST"><button type="submit" class="btn btn-link" name="gamename" id="gamename" value='{{g["Name"]}}'><h5>{{g['Name']}}</h5></button></form>
                    <p>Players: <span  class = 'gminplayers'>{{g["Min_Players"]}}</span> to <span  class = 'gmaxplayers'>{{g["Max_Players"]}}</span>
                      <br>Play time: <span  class = 'gminplaytime'>{{g["Min_Playtime"]}}</span> to <span  class = 'gmaxplaytime'>{{g["Max_Playtime"]}}</span> minutes
                    </p>
                  </td>
                  <td class="image"><img src='{{g["Image_URL"]}}' alt="" style="max-width: 100%"></td>
                  <td class="keywords"><strong>Keywords Matched:</strong><br>"{{input_string}}"</td>
                  <td class="model text-right"><strong>Board Game</strong></td>
                </tr>
                {% endfor %}
                {% for g in exactmatches['genres'] %}
                <tr class = 'genrerow' style = "max-height:20%">
                  <td class="name text-center">
                    <form action="/genre" method = "POST"><button type="submit" class="btn btn-link" title="main" name="genrename" id="genrename" value='{{g["Name"]}}'><strong>{{g['Name']}}</strong></button></form>
                  </td>
                  <td class="image"><img src='{{g["Image_URL"]}}' alt="" style="max-width: 100%"></td>
                  <td class="keywords"><strong>Keywords Matched:</strong><br>"{{input_string}}"</td>
                  <td class="model text-right"><strong>Genre</strong></td>
                </tr>
                </form>
                {% endfor %}
                {% for p in exactmatches['publishers'] %}
                <tr class = 'publisherrow' style = "max-height:20%">
                  <td class="name text-center">
                    <form action="/publisher" method = "POST"><button type="submit" class="btn btn-link" title="main" name="publishername" id="publishername" value='{{p["Name"]}}'><strong>{{p['Name']}}</strong></button></form>
                  </td>
                  <td class="image"><img src='{{p["Image_URL"]}}' alt="" style="max-width: 100%"></td>
                  <td class="keywords"><strong>Keywords Matched:</strong><br>"{{input_string}}"</td>
                  <td class="model text-right"><strong>Publisher</strong></td>
                </tr>
                </form>
                {% endfor %}
                {% for w in partialmatches.keys() %}
                {% for g in partialmatches[w]['boardgames'] %}
                <form action="/game" method = "POST">
                <tr class = "gamerow" style = "max-height:20%">
                    <td class="name text-center"><button type="submit" class="btn btn-link" name="gamename" value='{{g["Name"]}}'><strong>{{g['Name']}}</strong></button><br>
                      <p>Number of Players: <span  class = 'gminplayers'>{{g["Min_Players"]}}</span> to <span  class = 'gmaxplayers'>{{g["Max_Players"]}}</span>
                      <br>Game Playtime: <span  class = 'gminplaytime'>{{g["Min_Playtime"]}}</span> to <span  class = 'gmaxplaytime'>{{g["Max_Playtime"]}} minutes</span>
                    </p>
                    </td>
                  <td class="image" style="width: 20%"><img src='{{g["Image_URL"]}}' alt="" style="max-width: 100%"></td>
                  <td class="keywords"><strong>Keywords Matched:</strong><br>"{{w}}"</td>
                  <td class="model text-right"><strong>Board Game</strong></td>
                </tr>
                </form>
                {% endfor %}
                {% for g in partialmatches[w]['genres'] %}
                <form action="/genre" method = "POST">
                <tr class = "genrerow" style = "max-height:20%">
                    <td class="name text-center"><button type="submit" class="btn btn-link" name="genrename" value='{{g["Name"]}}'><strong>{{g['Name']}}</strong></button></td>
                  <td class="image" style="width: 20%"><img src='{{g["Image_URL"]}}' alt="" style="max-width: 100%"></td>
                  <td class="keywords"><strong>Keywords Matched:</strong><br>"{{w}}"</td>
                  <td class="model text-right"><strong>Genre</strong></td>
                </tr>
                </form>
                {% endfor %}
                {% for p in partialmatches[w]['publishers'] %}
                <form action="/publisher" method = "POST">
                <tr class = 'publisherrow' style = "max-height:20%">
                    <td class="name text-center"><button type="submit" class="btn btn-link" name="publishername" value='{{p["Name"]}}'><strong>{{p['Name']}}</strong></button></td>
                  <td class="image"><img src='{{p["Image_URL"]}}' alt="" style="max-width: 100%"></td>
                  <td class="keywords"><strong>Keywords Matched:</strong><br>"{{w}}"</td>
                  <td class="model text-right"><strong>Publisher</strong></td>
                </tr>
                </form>
                {% endfor %}
                {%endfor%}
              </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
</div>
{% endblock %}